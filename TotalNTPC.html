<!DOCTYPE HTML >
<html lang="en">
<head>
    
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Allocations</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <script type="text/javascript" src="Chart.PieceLabel.js"></script>

    <link rel="stylesheet" href="css/style.css">

</head>
<body style="background-color:#99cfe4;">
    <div id='cssmenu'>
        <ul>
            <li><a href='./index.html'>Critical Issues</a></li>
            <li><a href='./index_state.html'>State Info</a></li>
            <li><a href='./index_billing.html'>Billing</a></li>
            <li><a href='./index_ecr.html'>ECR</a></li>
            <li><a href='./index_home.html'>URS Sale</a></li>
            <li style="background-color:#707070;"><a href='#'>Market Analysis</a></li>
            <li><a href='./index_perf.html'>Performance Report</a></li>
            <li><a href='./index_alloc.html'>Allocations</a></li>
        </ul>
    </div>
    <section class="container">
        <div class="switch switch-blue">
            <input type="radio" class="switch-input" name="view2" value="state" id="weekasd2" checked onchange="handleClick(this)">
            <label for="weekasd2" class="switch-label switch-label-off">&nbsp;&nbsp;&nbsp;State-Wise&nbsp;&nbsp;&nbsp;</label>
            <input type="radio" class="switch-input" name="view2" value="plant" id="monthasd2" onchange="handleClick(this)">
            <label for="monthasd2" class="switch-label switch-label-on">&nbsp;&nbsp;&nbsp;Plant-Wise&nbsp;&nbsp;&nbsp;</label>
            <span class="switch-selection"></span>
        </div>
    </section>
    <br/>
    <div id="stateselect" style="width:100%;">
        <select name="statedrop" id="statedrop" style="width:100%;height:30px;font-size:20px;" onchange="statedrilldown(this.value)">
            <option value="Uttar Pradesh">Uttar Pradesh</option>
            <option value="Uttrakhand">Uttrakhand</option>
            <option value="Rajasthan">Rajasthan</option>
            <option value="Delhi">Delhi</option>
            <option value="Punjab">Punjab</option>
            <option value="Haryana">Haryana</option>
            <option value="Himachal">Himachal</option>
            <option value="J&K">J&K</option>
            <option value="Chandigarh">Chandigarh</option>
            <option value="Madhya Pradesh">Madhya Pradesh</option>
            <option value="Chattisgarh">Chattisgarh</option>
            <option value="Maharastra">Maharastra</option>
            <option value="Gujarat">Gujarat</option>
            <option value="Goa">Goa</option>
            <option value="Daman & Diu">Daman & Diu</option>
            <option value="Dadra & Nagar Haveli">Dadra & Nagar Haveli</option>
            <option value="Andhra Pradesh">Andhra Pradesh</option>
            <option value="Karnataka">Karnataka</option>
            <option value="Tamil Nadu">Tamil Nadu</option>
            <option value="Kerala">Kerala</option>
            <option value="A & N">A & N</option>
            <option value="TELANGANA">TELANGANA</option>
            <option value="PUDUCHERRY">PUDUCHERRY</option>
            <option value="West Bengal">West Bengal</option>
            <option value="Bihar">Bihar</option>
            <option value="Jharkhand">Jharkhand</option>
            <option value="Odisha">Odisha</option>
            <option value="Sikkim">Sikkim</option>
            <option value="Assam">Assam</option>
            <option value="Meghalaya">Meghalaya</option>
            <option value="Tripura">Tripura</option>
            <option value="Nagaland">Nagaland</option>
            <option value="Arunachal">Arunachal</option>
            <option value="Mizoram">Mizoram</option>
            <option value="Manipur">Manipur</option>
            <option value="Railways">Railways</option>
            <option value="SAIL">SAIL</option>
            <option value="DVC">DVC</option>
            <option value="PGCIL">PGCIL</option>
            <option value="Bangladesh">Bangladesh</option>
        </select>
        </div>


    <div id="plantselect" style="width:100%;display:none;">
        <select name="plantdrop" id="plantdrop" style="width:100%;height:30px;font-size:20px;" onchange="stationdrilldown(this.value)">
            <option value="Dadri-I">Dadri-I</option>
            <option value="Dadri-I">Saab</option>
            <option value="mercedes">Mercedes</option>
            <option value="audi">Audi</option>
            <option value="Singrauli">Singrauli</option>
                   <option value="Rihand-I" >Rihand-I</option>
                   <option value="Rihand-II" >Rihand-II</option>
                   <option value="Rihand-III" >Rihand-III</option>
                   <option value="Unch-I" >Unch-I</option>
                   <option value="Unch-II" >Unch-II</option>
                   <option value="Unch-III" >Unch-III</option>
                   <option value="Unch-IV" >Unch-IV</option>
                   <option value="Dadri-I" >Dadri-I</option>
                   <option value="Dadri-II" >Dadri-II</option>
                   <option value="Tanda" >Tanda</option>
                   <option value="BTPS" >BTPS</option>
                   <option value="Anta" >Anta</option>
                   <option value="Auraiya" >Auraiya</option>
                   <option value="Dadri Gas" >Dadri Gas</option>
                   <option value="Faridabad" >Faridabad</option>
                   <option value="Koldam " >Koldam</option>
                   <option value="Korba I&II" >Korba I&II</option>
                   <option value="Vind-I" >Vind-I</option>
                   <option value="Vind-II" >Vind-II</option>
                   <option value="Vind-III" >Vind-III</option>
                   <option value="Kawas" >Kawas</option>
                   <option value="Gandhar" >Gandhar</option>
                   <option value="Sipat-II" >Sipat-II</option>
                   <option value="Korba-III" >Korba-III</option>
                   <option value="Sipat-I" >Sipat-I</option>
                   <option value="Vind-IV" >Vind-IV</option>
                   <option value="Mauda-I" >Mauda-I</option>
                   <option value="Vind-V" >Vind-V</option>
                   <option value="Mauda-II" >Mauda-II</option>
                   <option value="Solapur" >Solapur</option>
                   <option value="Rama-I&II" >Rama-I&II</option>
                   <option value="Rama-III" >Rama-III</option>
                   <option value="Simh-I" >Simh-I</option>
                   <option value="Simh-II" >Simh-II</option>
                   <option value="Tal-II" >Tal-II</option>
                   <option value="KyCCPP" >KyCCPP</option>
                   <option value="Kudgi I" >Kudgi I</option>
                   <option value="Ramagundam Solar" >Ramagundam Solar</option>
                   <option value="A&N SOLAR" >A&N SOLAR</option>
                   <option value="Farakka" >Farakka</option>
                   <option value="Kh-I" >Kh-I</option>
                   <option value="Kh-II" >Kh-II</option>
                   <option value="TSTPS-I" >TSTPS-I</option>
                   <option value="TTPS" >TTPS</option>
                   <option value="Farakka-III" >Farakka-III</option>
                   <option value="BARH" >BARH</option>
                   <option value="Bongaigaon" >Bongaigaon</option>
                   <option value="D SOLAR" >D SOLAR</option>
                   <option value="TAL SOL" >TAL SOL</option>
                   <option value="UNCH SOL" >UNCH SOL</option>
                   <option value="FARD SOL" >FARD SOL</option>
                   <option value="RAJ SOL" >RAJ SOL</option>
                   <option value="SING SOL" >SING SOL</option>
                   <option value="Ananthapur Solar" >Ananthapur Solar</option>
                   <option value="Bhadla Solar" >Bhadla Solar</option>
                   <option value="Mandsaur Solar" >Mandsaur Solar</option>
                   <option value="Rojmal Wind Power" >Rojmal Wind Power</option>
                   <option value="Jhajjar" >Jhajjar</option>
                   <option value="Vallur" >Vallur</option>
                   <option value="Ratnagiri" >Ratnagiri</option>
                   <option value="Muzaffarpur" >Muzaffarpur</option>
                   <option value="Raurkela" >Raurkela</option>
                   <option value="Durgapur" >Durgapur</option>
                   <option value="Bhillai CPP-II" >Bhillai CPP-II</option>
                   <option value="Bhillai CPP-III" >Bhillai CPP-III</option>
                   <option value="BRBCL" >BRBCL</option>
                   <option value="KBUNL-II" >KBUNL-II</option>
        </select>
    </div>


        <div id="canvas-holder" style="width:100%">
            <canvas id="chart-area" width="100%" />
        </div>
        <div id="canvas-holder1" style="width:100%">
            <canvas id="chart-area1" width="100%" />
        </div>
        <div id="canvas-holder2" style="width:100%">
            <canvas id="chart-area2" width="100%" />
        </div>
        <div id="canvas-holder3" style="width:100%">
            <canvas id="chart-area3" width="100%" />
        </div>
        <div id="canvas-holder4" style="width:100%">
            <canvas id="chart-area4" width="100%" />
        </div>








       




        <script type='text/javascript' src='https://unpkg.com/fetch-jsonp@1.1.1'></script>
        <script src="GetSheetDone.js"></script>
        <script>
            function handleClick(myRadio) {                
                if (myRadio.value == "plant") {
                    document.getElementById('stateselect').style.display = "none";
                    document.getElementById('plantselect').style.display = "inline";
                }
                else if (myRadio.value == "state") {
                    document.getElementById('stateselect').style.display = "inline";
                    document.getElementById('plantselect').style.display = "none";
                }
            }


            let key,
                sheetNum,
                sheetType, counter = 0;
            function readValues() {
                key = '1iYytiqDgwxm8-kftu7S8jcAumkgc-zL2TXeivUivGhM';
                sheetNum = '7';
                sheetType = 'cols';
            }
            window.onload = function (ev) {
                ev.preventDefault();
                readValues();
                console.log(key, sheetNum, sheetType);
                stateregion();

              
            }



            function stateregion() {
                document.getElementById("canvas-holder3").innerHTML = '&nbsp;';
                document.getElementById("canvas-holder3").innerHTML = '<canvas id="chart-area3"></canvas>';

                document.getElementById('chart-area').style.display = "none";
                document.getElementById('chart-area1').style.display = "none";
                document.getElementById('chart-area2').style.display = "none";
                document.getElementById('chart-area3').style.display = "inline";
                document.getElementById('chart-area4').style.display = "none";

                //  alert(stationname);
                //ev.preventDefault();
                //  alert(statename + "state name");
                readValues();
                console.log(key, sheetNum, sheetType);
                //  alert(stationname+"00");
                let promise;
                switch (sheetType) {
                    case 'cols':
                        promise = GetSheetDone.labeledCols(key, sheetNum);
                        break;
                    case 'cols-rows':
                        promise = GetSheetDone.labeledColsRows(key, sheetNum);
                        break;
                    case 'raw':
                    default:
                        promise = GetSheetDone.raw(key, sheetNum);
                        break;
                }
                //  alert(stationname + "01");
                //  alert(stationname == "Singrauli");
                promise.then((data) => {
                    var jsonarray = JSON.stringify(data);
                    //  document.getElementById('outputty').innerHTML = jsonarray;
                    var obj = JSON.parse(jsonarray);
                    var coll = [];
                    for (var i = 0; i < obj.data.length; i++) {
                        for (var ky in obj.data[i]) {
                            if (coll.indexOf(ky) === -1) {
                                coll.push(ky);
                            }
                        }
                    }
                    // CREATE DYNAMIC TABLE.
                    var benefSeries = [];
                    var totalSeries = [];

                    var NR = 0;
                    var SR = 0;
                    var WR = 0;
                    var ER = 0;
                    var SPL = 0;

                  //  var table = document.getElementById('datatable01');//document.createElement('table');
                 //   table.style.border = "thin solid #a5f448";
                    //  alert(stationname == "Singrauli");


                    for (var i = 2; i < (obj.data.length - 1) ; i++) {

                        if (obj.data[i].a == "Uttar Pradesh" || obj.data[i].a == "Uttrakhand" || obj.data[i].a == "Rajasthan" || obj.data[i].a == "Delhi" || obj.data[i].a == "Punjab" || obj.data[i].a == "Haryana" || obj.data[i].a == "Himachal" || obj.data[i].a == "J&K" || obj.data[i].a == "Chandigarh")
                            NR += parseFloat(obj.data[i].b);
                        if (obj.data[i].a == "Madhya Pradesh" || obj.data[i].a == "Chattisgarh" || obj.data[i].a == "Maharastra" || obj.data[i].a == "Gujarat" || obj.data[i].a == "Goa" || obj.data[i].a == "Daman & Diu" || obj.data[i].a == "Dadra & Nagar Haveli")
                            WR += parseFloat(obj.data[i].b);
                        if (obj.data[i].a == "Andhra Pradesh" || obj.data[i].a == "Karnataka" || obj.data[i].a == "Tamil Nadu" || obj.data[i].a == "Kerala" || obj.data[i].a == "A & N" || obj.data[i].a == "TELANGANA" || obj.data[i].a == "PUDUCHERRY")
                            SR += parseFloat(obj.data[i].b);
                        if (obj.data[i].a == "West Bengal" || obj.data[i].a == "Bihar" || obj.data[i].a == "Jharkhand" || obj.data[i].a == "Odisha" || obj.data[i].a == "Sikkim" || obj.data[i].a == "Assam" || obj.data[i].a == "Meghalaya" || obj.data[i].a == "Tripura" || obj.data[i].a == "Nagaland" || obj.data[i].a == "Arunachal" || obj.data[i].a == "Mizoram" || obj.data[i].a == "Manipur")
                            ER += parseFloat(obj.data[i].b);
                        if (obj.data[i].a == "Railways" || obj.data[i].a == "SAIL" || obj.data[i].a == "DVC" || obj.data[i].a == "PGCIL" || obj.data[i].a == "Bangladesh" || obj.data[i].a == "NTPC Merchant Power")
                            SPL += parseFloat(obj.data[i].b);
                    }


                    benefSeries.push("NR");
                    benefSeries.push("WR");
                    benefSeries.push("SR");
                    benefSeries.push("ER");
                    benefSeries.push("Others");
                    totalSeries.push(parseFloat(NR));
                    totalSeries.push(parseFloat(SR));
                    totalSeries.push(parseFloat(WR));
                    totalSeries.push(parseFloat(ER));
                    totalSeries.push(parseFloat(SPL));



                    var ctx = document.getElementById("chart-area3").getContext("2d");
                    //  alert(benefSeries[0] + "******" + totalSeries[0]);
                    ///   alert(benefSeries[1] + "******" + totalSeries[1]);
                    //   alert(benefSeries[6] + "******" + totalSeries[2]);
                    var config = {
                        type: 'pie',
                        data: {
                            datasets: [{
                                data: totalSeries,
                                backgroundColor: ["#68f2c3", "#59c0df", "#66eee4", "#42ff00", "#fff014", "#f33131", "#9cfe1f", "#2da7c1", "#ffc800", "#4b3832", "#be9b7b", "#f7d0cb", "#56d9ec", "#e6a8bf", "#bddff9", "#1e72bf", "#ead1ab", "#a2dbc5", "#c7ae7d"]
                            }],
                            labels: benefSeries
                        },
                        options: {
                            responsive: true,
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 10,
                                    fontStyle: 'bold',
                                    fontSize: 10
                                }
                            },
                            pieceLabel: {
                                render: function (args) {
                                    //   alert(args.label+"12312");
                                    return args.label + '  (' + args.value + ' MW)  ';
                                },
                                fontSize: 9,
                                fontColor: '#3e2507',
                                position: 'outside'
                            }
                        }
                    };
                    //alert("yahoo1");
                    window.myPie = new Chart(ctx, config);

                    document.getElementById("chart-area3").ondblclick = function (evt) {
                        var activePoint = myPie.getElementAtEvent(evt)[0];
                        var data = activePoint._chart.data;
                        var datasetIndex = activePoint._datasetIndex;
                        var label = data.labels[activePoint._index];
                        var value = data.datasets[datasetIndex].data[activePoint._index];
                        // alert(label + "---" + value);
                        //window.location.reload();
                       // stateregiondrilldown(label); //console.log(label, value);
                    };


                }).catch(err => {
                    console.log('Error');
                    console.log(err);
                    document.getElementById('output').innerHTML = err.message;
                })
            }


            // }
        </script>

</body>
</html>
